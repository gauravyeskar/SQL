use mobile_db;
select * from sm;
-- Rank():-
-- Write a query to rank all smartphones based on their Rating globally, from highest to lowest.
select brand_name, model,rating,rank()over(order by rating desc) as rnk from sm;

-- Rank all phones within each Brand based on their Price (lowest price gets rank 1).
select brand_name,price,rank()over(partition by brand_name order by price asc) as Price_RNK from sm;

-- Find the top 5 highest-rated smartphones overall using Rank().
with cte as ( select brand_name,price,rating,rank() over(order by rating desc) as rnk from sm)
select brand_name,price,rating,rnk from cte where rnk <=5 ; 

-- Partition the data by Brand and rank phones by Rating. Filter the result to show only phones ranked 3 or better within their brand.
with cte as (select brand_name,Rating,rank()over(partition by brand_name order by rating desc) as rnk from sm) 
select brand_name,rating,rnk from cte where rnk<=3;

-- Rank phones based on Price globally. If two phones have the same price, they should have the same rank.
select brand_name,price,rank()over(order by price desc) as rnk from sm;

-- Display the Model Name and Brand for all phones that tie for the highest Rating (Rank 1) across the entire dataset.
with cte as (select brand_name,model,rating,rank()over(order by rating desc) as rnk from sm) 
select brand_name,model,rating,rnk from cte where rnk = 1;

-- Rank the phones in the 'Xiaomi' brand by Price in ascending order.
select brand_name,price,rank()over(order by price) as rnk from sm where brand_name = 'Xiaomi'; 

-- Rank all phones based on the combination of Rating (descending) and Price (ascending).
with cte as( select brand_name,price,rating,rank()over(order by rating desc,price asc) as rnk from sm) 
select brand_name,price,rating,rnk from cte;

-- Find the highest-priced phone for each brand and assign it Rank 1, using Rank().
select brand_name,price,rank() over(partition by brand_name order by price desc) as rnk from sm;

-- Write a query to find the rank of a specific model (e.g., 'Xiaomi 14') based on its Rating globally.
with cte as ( select brand_name, model, rating,rank()over(order by rating desc) as rnk from sm) 
select brand_name, model, rating,rnk from cte where model = "Xiaomi 14";

-- #######################################
-- Dense_Rank():- 
-- Write a query to assign a dense rank to all smartphones based on their Rating globally, from highest to lowest.
select brand_name,price,rating,dense_rank() over(order by rating desc) as drnk from sm;

-- What is the difference in the maximum rank assigned by RANK() vs DENSE_RANK() when ranking phones by Price globally?
with cte as ( select brand_name,model,price,rank() over(order by price desc) as rnk, dense_rank() over(order by price desc) as drnk from sm)
select max(rnk) as max_rnk,max(drnk) as max_denk,(max(rnk) - max(drnk)) as diff from cte;

-- Partition the data by Brand and use DENSE_RANK() to rank phones by Rating.
select brand_name,price,rating ,dense_rank() over(partition by brand_name order by rating desc) as drnk from sm;

-- Find the top 3 distinct rating levels DENSE RANK() across the entire dataset.
with dist as( select distinct(rating) from sm), 
drnk as (select rating,dense_rank() over(order by rating desc) as drnk from dist) 
select rating as top_rating, drnk from drnk where drnk <= 3;	

-- List all phones that share the 2nd best dense rank in terms of Price within the 'ZTE' brand.
with cte as ( select brand_name,price,dense_rank() over(order by price desc)as drnk from sm where brand_name = 'ZTE')
select brand_name,price,drnk from cte where drnk = 2;

-- Use Dense_Rank() to identify the second-highest Price point overall.
with cte as (select brand_name,price,dense_rank() over(order by price desc) as drnk from sm)
select brand_name,price,drnk from cte where drnk = 2;

-- Display the Brand, Model Name, and the dense rank based on Rating, but only for phones with a rank of 5 or less.
with cte as (select brand_name,model,rating,dense_rank()over(order by rating desc) as  drnk from sm)
select brand_name,model,rating,drnk from cte where drnk <=5;

-- Compare the results of Rank() and Dense_Rank() side-by-side for the top 10 phones by Price.
with cte as ( select brand_name,model,price,rank() over(order by price desc) as rnk, dense_rank() over(order by price desc) as drnk,row_number()over(order by price desc)as rn from sm) 
select rn,brand_name,model,price,rnk,drnk from cte where rn <= 10;

-- Rank phones densely by Rating within the 'Samsung' brand.
select brand_name,rating,dense_rank()over(order by rating desc) as drnk from sm where brand_name = 'Samsung';

-- How many distinct rank numbers are generated by Dense_Rank() when partitioning by Brand and ordering by Price?
with cte as (select brand_name,price,dense_rank() over(partition by brand_name order by price desc) as drnk from sm) 
select count(distinct(drnk)) from cte;

-- #########################################
-- Row_Number():- 
-- Assign a unique, sequential row number to every phone when ordered by Price in descending order.
select brand_name,price,row_number() over(order by price desc) as rn from sm;

-- Partition the data by Brand and assign a sequential row number to each phone based on its Rating (highest rating first).
select brand_name,price,row_number() over(partition by brand_name order by rating desc) as rn from sm;

-- Select the single best-rated phone (Row Number 1) for every Brand.
with cte as (select brand_name,price,rating,row_number() over(partition by brand_name order by rating desc) as rn from sm)
select brand_name,price,rating,rn from cte where rn = 1;

-- Retrieve the 5th phone model listed alphabetically within the 'Xiaomi' brand using Row_Number().
with cte as (select brand_name,model,price,row_number() over(order by model) as rn from sm where brand_name = 'Xiaomi')
select brand_name,model,price,rn from cte where rn = 5;

-- Assign a row number to all phones, ordered alphabetically by Model_Name.
select model,price,row_number() over(order by model) as rn from sm;

-- Use row_Number to identify the 3 most expensive phones overall.
with cte as ( select brand_name,price,row_number() over(order by price desc) as rn from sm) 
select brand_name,price,rn from cte where rn <=3 ;

-- Write a query to show the Model Name, Brand, and a sequential number for all phones in the 'Samsung' brand, ordered by Rating.
select brand_name,model,rating,row_number() over(order by rating desc) as rn from sm where brand_name = "Samsung";

-- How can ROW_NUMBER() be used in a subquery to implement pagination (e.g., showing rows 11 through 20 of all phones 
-- ordered by price)?
with cte as (select brand_name,model,price,row_number()over(order by price desc) as rn from sm ) 
select brand_name,model,price,rn from cte where rn between 11 and 20;

-- Assign a unique row number to phones partitioned by the first letter of their Model_Name.
select brand_name,model,price,left(model,1) as first_ltr,row_number() over(partition by left(model,1) order by price desc) as rn from sm;

-- Find the difference between the Row Number based on ascending Price and the Row Number based on ascending Rating 
-- each phone.
select brand_name,model,price,rating,row_number()over(order by price) as rn1,row_number()over(order by rating)as rn2,
(row_number()over(order by price asc) - row_number()over(order by rating asc))as diff from sm;

-- #######################################
-- First_Value():- 
-- Write a query to display the lowest Price (the first value when ordering by price ascending) for the entire dataset next to every phone's price.
select brand_name,price,first_value(price)over(order by price) as fv from sm;

-- For each phone, display the highest Rating available within its Brand.
select brand_name,rating,first_value(rating)over(partition by brand_name order by rating desc)as fv from sm;

-- Display the Model_Name of the most expensive phone within each Brand.
select model,price,first_value(model)over(partition by brand_name order by price desc)as fv from sm;

-- Find the Brand name of the phone with the highest overall Rating and display it in a column next to all other rows.
select brand_name,price,rating,first_value(brand_name)over(order by rating desc)as fv from sm;

-- What is the Price of the first phone encountered when partitioning by Brand and ordering by Model_Name alphabetically?
select brand_name,price,first_value(price)over(partition by brand_name order by model )as fv from sm;

-- Write a query to see the price of the first phone released by a brand (ordered by a hypothetical Release_Date 
-- column, which you can simulate by ordering by Model_Name ascending).
select brand_name,price,first_value(brand_name)over(order by model) as fv from sm;

-- Calculate the difference between each phone's Price and the cheapest phone's price in its respective Brand.
select brand_name,price,max(price)over(partition by brand_name order by price desc) as max_price,min(price)over(partition by brand_name order by price asc) as min_price,
(max(price)over(partition by brand_name )-min(price)over(partition by brand_name )) as diff from sm;

-- For the 'Xiaomi' brand, use Row_Number to show the Rating of their best-rated phone next to every phone's row.
select brand_name,model,rating,first_value(rating)over(order by rating desc) as fv from sm where brand_name = 'Xiaomi';

-- Find the Model_Name of the highest-rated phone when considering only phones within the current row's preceding
-- 5 rows (frame definition: ROWS BETWEEN 5 PRECEDING AND CURRENT ROW).
select model,rating,first_value(model)over(order by rating desc rows between 5 preceding and Current row)as fv from sm;

-- Use First_Value to display the lowest Price within the entire table, regardless of partitioning.
select brand_name,price,first_value(price)over(order by price asc) as fv from sm;

-- #######################################
-- Last_Value():-
-- Display the highest Price (the last value when ordering by price ascending) for the entire dataset next to every phone's price. (Requires specific frame definition).
select brand_name,price,last_value(price)over(order by price rows between unbounded preceding and unbounded following)as lv from sm;

-- For each phone, display the lowest Rating (the last value when ordering by rating descending) available
--  within its Brand.
select brand_name,rating,last_value(rating)over(partition by brand_name order by rating desc
 rows between unbounded preceding and unbounded following)as lv from sm;

-- Display the Model_Name of the least expensive phone within each Brand.
select brand_name,model,price,last_value(model)over(partition by brand_name order by price desc rows between unbounded preceding and unbounded following) as lv from sm;

-- Find the Brand name of the phone with the lowest overall Rating and display it in a column next to all other rows.
select brand_name,rating,last_value(brand_name) over(order by rating desc rows between unbounded preceding and unbounded following) as lv from sm;

-- What is the Rating of the last phone encountered when partitioning by Brand and ordering by Model_Name alphabetically?
select brand_name,model,rating,last_value(rating)over(partition by brand_name order by model rows between unbounded preceding and unbounded following) as lv from sm;

-- Use Last_Value() with a frame of ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING to retrieve the highest Price globally.
select brand_name,model,price,last_value(price)over(order by price rows between unbounded preceding and unbounded following) as lv from sm;

-- Calculate the difference between each phone's Price and the most expensive phone's price in its respective Brand.
select brand_name,price,last_value(price)over(partition by brand_name order by price rows between unbounded preceding and unbounded following) as lv,
(last_value(price)over(partition by brand_name order by price rows between unbounded preceding and unbounded following) - price) as diff from sm;

-- For the 'Samsung' brand, use Last_Value() to show the Price of their most expensive phone (when ordering by Price ascending) next to every phone's row.
select model,price,last_value(price)over(order by price rows between unbounded preceding and unbounded following)as
 lv from sm where brand_name='Samsung' order by price desc;

-- Find the Model_Name of the lowest-rated phone when considering only phones within the current row's succeeding 
-- 5 rows (frame definition: ROWS BETWEEN CURRENT ROW AND 5 FOLLOWING).
select brand_name,model,rating,last_value(model)over(order by rating rows between current row and 5 following) as lv from sm;

-- Write a query to see the Price of the last phone listed in the data after ordering all phones by Rating descending.
select brand_name,price,rating,last_value(price)over(order by rating desc rows between unbounded preceding and unbounded following) as lv from sm;

-- #########################################
-- Nth_Value():- 
-- Write a query to display the Model_Name of the 3rd highest-rated phone overall.
select brand_name,model,price,nth_value(model,3)over(order by rating desc) as nv from sm;

-- For each phone, display the Price of the 2nd cheapest phone within its Brand.
select brand_name,price,nth_value(price,2)over(partition by brand_name order by price rows between unbounded preceding and unbounded following) as nv from sm;

-- Find the Rating of the phone that ranks 4th by price (descending) across the entire dataset.
select brand_name,price,rating,nth_value(rating,4)over(order by price desc rows between unbounded preceding and unbounded following)as nv from sm order by rating desc;

-- Partition the data by Brand and find the Model_Name of the 5th phone when ordered alphabetically by Model_Name within that brand.
select brand_name,model,nth_value(model,5)over(partition by brand_name order by model desc rows between unbounded preceding and unbounded following) as nv from sm;

-- Use Nth_VALUE() to find the Price of the 2nd most expensive phone for each brand.
select brand_name,price,nth_value(price,2)over(partition by brand_name order by price desc rows between unbounded preceding and unbounded following) as nv from sm;

-- If a brand has fewer than 3 phones, what is the result of trying to find the 3rd Model_Name using
-- Nth_VALUE() Demonstrate this with a query (assuming a brand like 'ZTE' has only 2 rows).
SELECT Brand_name, Model, Price, NTH_VALUE(Model, 3) over ( order by Price desc ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING ) AS Third_Model
from sm where brand_name = 'ZTE' order by Price desc;

-- Find the Nth_VALUE of 2 to identify the second-highest Rating overall.
select brand_name,rating,nth_value(rating,2) over(order by rating desc rows between unbounded preceding and unbounded following) as nv from sm;

-- Write a query to display the Model_Name that ranks 3rd best by Rating for the 'Xiaomi' brand.
select brand_name,model,rating,nth_value(model,3) over(order by rating desc rows between unbounded preceding and unbounded following) as nv from sm where brand_name = 'Xiaomi';

-- What is the average Price of all phones, compared to the Price of the phone that ranks 10th by Rating? Nth_VALUE()  for the 10th phone).
SELECT Brand_name,Model,Price,NTH_VALUE(Price, 10) OVER (
        ORDER BY Rating DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS Price_of_10th_Rated, AVG(Price) OVER () AS Global_Average_Price,(
        NTH_VALUE(Price, 10) OVER ( ORDER BY Rating DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
        ) - AVG(Price) OVER () ) AS Difference_10th_vs_Avg
FROM sm
ORDER BY Rating DESC;

-- Use Nth_value() to display the Brand of the 1st phone when ordered by Price (descending). (This is a good way to test if you can use Nth_VALUE(Brand, 1)$).
SELECT Brand_name,Model,Price, NTH_VALUE(Brand_name, 1) OVER ( ORDER BY Price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWINg ) AS Brand_Of_Most_Expensive
FROM sm ORDER BY Price DESC;